'use strict';

let path = require('path');
module.exports = function (callback, args) {
    return {
        process: function (next, input, output, config, fileContent, relFilePath) {
            try {
                let filePath = path.join(config.rootDir, relFilePath);
                delete require.cache[require.resolve(filePath)];
                let handler = require(filePath).apply(undefined, args || []);
                if (typeof handler === 'function') {
                    callback(relFilePath, handler);
                    next();
                } else {
                    next(`Module of handler returns not a function! (path: ${relFilePath})`);
                }
            } catch (error) {
                next(error);
            }
        }
    };
};
